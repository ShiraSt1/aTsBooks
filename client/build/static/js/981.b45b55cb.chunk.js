"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[981],{8981:(e,a,t)=>{t.r(a),t.d(a,{default:()=>j});var l=t(9379),s=t(5043),o=t(2018),i=t(65),n=t(9722),c=t(5797),r=t(8055),d=t(748),m=t(4315),u=t(7780),p=t(3003),h=t(579);const g=e=>{const{createBook:a,visibleCreatBook:t,setVisibleCreatBook:l}=e,{token:i}=(0,p.d4)((e=>e.token)),[g,x]=(0,s.useState)(""),[f,j]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[y,k]=(0,s.useState)(!1),[N,S]=(0,s.useState)(!1),[C,w]=(0,s.useState)(null),[A,B]=(0,s.useState)(null),{gradeId:F}=(0,m.g)();(0,s.useEffect)((()=>{(async()=>{try{const e=await n.A.get("".concat("http://localhost:3001/","api/grade"),{headers:{Authorization:"Bearer ".concat(i)}});if(204===e.status)v([]);else{const a=e.data.map((e=>({label:e.name,value:e.name,id:e._id})));if(v(a),F){const e=a.find((e=>e.id===F));e&&j([e.value])}}}catch(e){console.error("Error fetching grades:",e),v([])}})()}),[F]);return(0,h.jsx)(c.l,{visible:t,modal:!0,header:"Create Book",style:{width:"400px",borderRadius:"8px"},onHide:()=>l(!1),children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1rem"},children:[(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"name",className:"font-medium",children:"Name"}),(0,h.jsx)(r.S,{id:"name",className:"p-inputtext-sm ".concat(y?"p-invalid":""),type:"text",value:g,onChange:e=>x(e.target.value),placeholder:"Enter book name"}),y&&(0,h.jsx)("small",{className:"p-error",children:"This field is required."})]}),(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"grades",className:"font-medium",children:"Grades"}),(0,h.jsx)(d.K,{id:"grades",value:f,options:b,onChange:e=>j(e.value),optionLabel:"label",placeholder:"Select Grades",display:"chip",className:"p-multiselect-sm",virtualScrollerOptions:{itemSize:38}})]}),(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"image",className:"font-medium",children:"Upload Image"}),(0,h.jsx)(u.e,{name:"image",customUpload:!0,accept:"image/*",maxFileSize:5242880,uploadHandler:e=>{const a=e.files[0];a&&(w(a),B(URL.createObjectURL(a)))},emptyTemplate:(0,h.jsx)("p",{children:"Drag an image file or click to select."}),chooseLabel:"Choose",uploadLabel:"Confirm",cancelLabel:"Cancel"}),A&&(0,h.jsx)("img",{src:A,alt:"Preview",style:{width:150,marginTop:10}})]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-2",children:[(0,h.jsx)(o.$,{label:"Create",onClick:()=>{a(g,f,C),l(!1),w(null),B(null),x(null)},className:"p-button p-button-primary"}),(0,h.jsx)(o.$,{label:"Cancel",onClick:()=>{l(!1),w(null),B(null),x(null)},className:"p-button p-button-secondary"})]})]})})},x=e=>{const{updateBook:a,visible:t,book:l={},setVisible:i}=e,[m,p]=(0,s.useState)(null),[g,x]=(0,s.useState)(null!==l&&void 0!==l&&l.image?"".concat("http://localhost:3001/").concat(l.image):""),[f,j]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),y=(0,s.useRef)(""),[k,N]=(0,s.useState)((null===l||void 0===l?void 0:l.name)||"");(0,s.useEffect)((()=>{(async()=>{try{const e=await n.A.get("".concat("http://localhost:3001/","api/grade"));if(204===e.status)j([]);else{const a=e.data.map((e=>({label:e.name,value:e.name})));j(a)}}catch(e){console.error("Error fetching grades:",e),j([])}})()}),[]),(0,s.useEffect)((()=>{if(null!==l&&void 0!==l&&l.grades&&l.grades.length>0){const e=l.grades.map((e=>e.name));v(e)}}),[l,f]),(0,s.useEffect)((()=>{null!==l&&void 0!==l&&l.image&&x("".concat("http://localhost:3001/").concat(l.image))}),[l.image]);return(0,h.jsx)(c.l,{visible:t,modal:!0,header:"Update Book",style:{width:"400px",borderRadius:"8px"},onHide:()=>{p(null),x(l.image||""),i(!1)},children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1rem"},children:[(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"name",className:"font-medium",children:"Name"}),(0,h.jsx)(r.S,{id:"name",placeholder:"Enter book name",className:"p-inputtext-sm",onChange:e=>{N(e.target.value)},defaultValue:(null===l||void 0===l?void 0:l.name)||""})]}),(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"grades",className:"font-medium",children:"Grades"}),(0,h.jsx)(d.K,{id:"grades",value:b,options:f,onChange:e=>v(e.value),optionLabel:"label",placeholder:"Select Grades",display:"chip",className:"w-full md:w-20rem custom-multiselect"})]}),(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"image",className:"font-medium",children:"Upload New Image"}),(0,h.jsx)(u.e,{name:"image",customUpload:!0,accept:"image/*",maxFileSize:5242880,uploadHandler:e=>{const a=e.files[0];a&&(p(a),x(URL.createObjectURL(a)))},emptyTemplate:(0,h.jsx)("p",{children:"Drag an image file or click to select."})}),g&&(0,h.jsx)("img",{src:g,alt:"Preview",style:{width:150,marginTop:10}})]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-2",children:[(0,h.jsx)(o.$,{label:"Update",onClick:()=>{N(y.current.value||l.name);const e=m||l.image;a(k,b,e,l),i(!1)},className:"p-button p-button-primary"}),(0,h.jsx)(o.$,{label:"Cancel",onClick:()=>{p(null),x(l.image||""),i(!1)},className:"p-button p-button-secondary"})]})]})})};t(9906);var f=t(3740);function j(){const[e,a]=(0,s.useState)([]),[t,c]=(0,s.useState)("grid"),[r,d]=(0,s.useState)({}),[u,j]=(0,s.useState)(!1),[b,v]=(0,s.useState)(""),[y,k]=(0,s.useState)(!1),[N,S]=(0,s.useState)(!1),{gradeId:C}=(0,m.g)(),{token:w}=(0,p.d4)((e=>e.token)),{user:A}=(0,p.d4)((e=>e.token)),B=(0,m.Zp)();(0,s.useEffect)((()=>{C?(F(C),U(C)):(E(),v(""))}),[C,u]);const F=async e=>{try{const a=await n.A.get("".concat("http://localhost:3001/","api/grade/").concat(e));200===a.status&&v(a.data.name)}catch(a){console.error("Error fetching grade name:",a),v("")}},E=async()=>{try{const e=await n.A.get("".concat("http://localhost:3001/","api/book"));200===e.status&&a(e.data)}catch(e){console.error(e)}},U=async e=>{try{const t=await n.A.get("".concat("http://localhost:3001/","api/book/grade/").concat(e));200===t.status&&a(t.data)}catch(t){400===t.status&&alert("there are no book for this grade")}},[L,T]=(0,s.useState)(!1),$=e=>(0,h.jsx)("div",{className:"col-12 sm:col-6 lg:col-12 xl:col-4 p-2",children:(0,h.jsxs)("div",{className:"p-4 border-1 surface-border surface-card border-round",onClick:()=>{return a=e._id,void(w?B("/titles/".concat(a)):alert("You are not allowed to view the book files."));var a},style:{cursor:"pointer"},children:[(0,h.jsxs)("div",{className:"flex flex-column align-items-center gap-3 py-5",children:[(0,h.jsx)("img",{className:"object-cover w-full h-full",src:"".concat("http://localhost:3001/").concat(e.image),alt:e.name,style:{objectFit:"cover",width:"80%",height:"80%"}}),(0,h.jsx)("div",{className:"text-2xl font-bold",children:e.name}),e.grades&&e.grades.length>0&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("strong",{children:"Suitable for:"}),(0,h.jsx)("ul",{className:"m-0 pl-3 list-disc text-xs",children:e.grades.map(((e,a)=>(0,h.jsx)("li",{children:e.name},a)))})]})]}),(0,h.jsx)("div",{className:"card flex flex-wrap gap-2 justify-content-center",children:"Admin"===(null===A||void 0===A?void 0:A.roles)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(o.$,{icon:"pi pi-pencil",onClick:a=>{a.stopPropagation(),S(!0),d(e)},tooltip:"Edit"}),(0,h.jsx)(o.$,{icon:"pi pi-trash",onClick:a=>{a.stopPropagation(),(async e=>{T(!0);try{await n.A.delete("".concat("http://localhost:3001/","api/book/").concat(e),{headers:{Authorization:"Bearer ".concat(w)}}),j(!u)}catch(a){console.error("Error deleting book:",a)}finally{T(!1)}})(e._id)},tooltip:"Delete"})]})})]})},e._id);return(0,h.jsxs)("div",{children:[L&&(0,h.jsxs)("div",{style:{margin:"20px"},children:[(0,h.jsx)(f.p,{style:{width:"30px",height:"30px"},strokeWidth:"5"}),(0,h.jsx)("p",{children:"Wait just a moment please..."})]}),(0,h.jsx)("div",{children:b&&(0,h.jsx)("h1",{className:"grade-header",children:b})}),"Admin"===(null===A||void 0===A?void 0:A.roles)&&(0,h.jsx)(o.$,{icon:"pi pi-plus",rounded:!0,"aria-label":"Filter",onClick:()=>k(!0),className:"add-button"}),(0,h.jsx)(g,{createBook:async(e,a,t)=>{T(!0),t||alert("confirm the image");const l=new FormData;l.append("name",e),l.append("grades",JSON.stringify(a)),l.append("image",t);try{const e=await n.A.post("".concat("http://localhost:3001/","api/book"),l,{headers:{Authorization:"Bearer ".concat(w),"Content-Type":"multipart/form-data"}});200!==e.status&&201!==e.status||(C?U(C):E())}catch(s){alert(s.res.data.mes),400===s.status&&console.error("Error creating book:",s),402===s.status&&alert("this book name alrady exits")}finally{T(!1)}},setVisibleCreatBook:k,visibleCreatBook:y}),(0,h.jsx)("div",{className:"card",children:(0,h.jsx)(i.U$,{value:Array.isArray(e)?e:[],listTemplate:(e,a)=>(0,h.jsx)("div",{className:"grid grid-nogutter",children:e.map(((e,a)=>(e=>{if(e)return $(e)})(e)))}),layout:t})}),r?(0,h.jsx)(x,{updateBook:async(e,a,t,s)=>{T(!0);const o=(0,l.A)((0,l.A)({},s),{},{name:e||s.name,grades:a,image:t||s.image});try{200===(await n.A.put("".concat("http://localhost:3001/","api/book"),o,{headers:{Authorization:"Bearer ".concat(w),"Content-Type":"multipart/form-data"}})).status&&j(!u)}catch(i){console.error(i)}finally{T(!1)}},setVisible:S,visible:N,book:r}):(0,h.jsx)(h.Fragment,{})]})}},9906:()=>{}}]);
//# sourceMappingURL=981.b45b55cb.chunk.js.map