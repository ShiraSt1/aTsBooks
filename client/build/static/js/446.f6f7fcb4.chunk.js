"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[446],{446:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var s=a(9379),l=a(5043),o=a(8072),r=a(2018),i=a(5797),n=a(7780),c=a(828),d=a(8055),m=a(9722),u=a(4315),p=a(3003),h=a(579);const f=()=>{const[e,t]=(0,l.useState)([]),[a,f]=(0,l.useState)(!1),[x,v]=(0,l.useState)(null),[y,w]=(0,l.useState)(""),[g,j]=(0,l.useState)(null),[b,k]=(0,l.useState)({}),[N,A]=(0,l.useState)(null),{token:C}=(0,p.d4)((e=>e.token)),{user:S}=(0,p.d4)((e=>e.token)),z=(0,l.useRef)(null),{bookId:_}=(0,u.g)(),E=(0,u.Zp)();(0,l.useEffect)((()=>{(async()=>{try{const e=await m.A.get("".concat("https://atsbooks.onrender.com/","api/book/").concat(_),{headers:{Authorization:"Bearer ".concat(C)}});A(e.data)}catch(e){400===e.status&&(null===z||void 0===z||z.current.show({severity:"error",summary:"Error",detail:"No book found",life:3e3})),console.error("error loading book:",e)}})(),B()}),[]);const B=async()=>{try{const e=(await m.A.get("".concat("https://atsbooks.onrender.com/","api/title/getTitlesByBook/").concat(_),{headers:{Authorization:"Bearer ".concat(C)}})).data,a={};for(const t of e){const e=await m.A.get("".concat("https://atsbooks.onrender.com/","api/file/title/").concat(t._id),{headers:{Authorization:"Bearer ".concat(C)}});a[t._id]=e.data}k(a);const s=e.map((e=>({label:(0,h.jsxs)("div",{className:"flex justify-between align-items-center w-full",children:[(0,h.jsx)("span",{children:e.name}),"Admin"===(null===S||void 0===S?void 0:S.roles)&&(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(r.$,{icon:"pi pi-plus",rounded:!0,text:!0,size:"small",onClick:t=>{t.stopPropagation(),v(e._id),f(!0)}})})]}),items:(a[e._id]||[]).map((t=>({label:(0,h.jsxs)("div",{className:"flex justify-between align-items-center w-full gap-2",children:[(0,h.jsx)("span",{style:{maxWidth:"30%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t.name,children:t.name}),(0,h.jsxs)("span",{className:"flex gap-2",children:[(0,h.jsx)(r.$,{icon:"pi pi-eye",rounded:!0,text:!0,size:"small",onClick:e=>{e.stopPropagation(),E("/fileview/".concat(t._id))}}),(0,h.jsx)(r.$,{icon:"pi pi-download",rounded:!0,text:!0,size:"small",onClick:e=>{e.stopPropagation(),window.open("".concat("https://atsbooks.onrender.com/","api/file/download/").concat(t._id,"?name=").concat(t.customName||t.name),"_blank")}}),"Admin"===(null===S||void 0===S?void 0:S.roles)&&(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(r.$,{icon:"pi pi-trash",rounded:!0,text:!0,size:"small",severity:"danger",onClick:a=>{a.stopPropagation(),F(t._id,e._id)}})})]})]})})))})));t(s)}catch(a){var e;console.error(a),null===(e=z.current)||void 0===e||e.show({severity:"error",summary:"Error",detail:"Error loading",life:3e3})}},F=async(e,t)=>{try{var a;await m.A.delete("".concat("https://atsbooks.onrender.com/","api/file/").concat(e),{headers:{Authorization:"Bearer ".concat(C)}}),k((a=>(0,s.A)((0,s.A)({},a),{},{[t]:a[t].filter((t=>t._id!==e))}))),B(),null===(a=z.current)||void 0===a||a.show({severity:"success",summary:"Deleted",detail:"File deleted successfuly",life:2e3})}catch(o){var l;console.error(o),null===(l=z.current)||void 0===l||l.show({severity:"error",summary:"Error",detail:"Error deleting",life:3e3})}},[$,P]=(0,l.useState)("");return(0,h.jsxs)("div",{className:"p-4",children:[N&&(0,h.jsx)("h2",{className:"text-center mb-4",children:N.name}),(0,h.jsxs)("div",{className:"flex flex-column md:flex-row gap-4",children:[(null===N||void 0===N?void 0:N.image)&&(0,h.jsx)("div",{className:"flex justify-content-center md:w-4",children:(0,h.jsx)("img",{src:"".concat("https://atsbooks.onrender.com/").concat(N.image),alt:"Book",className:"border-round shadow-2",style:{maxWidth:"100%",maxHeight:"500px",objectFit:"contain"}})}),(0,h.jsx)("div",{className:"flex-grow-1",children:(0,h.jsx)(o.G,{model:e,className:"w-full md:w-30rem"})})]}),(0,h.jsx)(i.l,{header:"Upload new file",visible:a,onHide:()=>{f(!1),j(null),P("")},style:{width:"30rem",borderRadius:"8px",textAlign:"center"},className:"custom-upload-dialog",children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1.5rem"},children:[(0,h.jsx)("label",{htmlFor:"fileName",className:"font-medium",style:{textAlign:"left"},children:"File name"}),(0,h.jsx)(d.S,{id:"fileName",placeholder:"Enter file name",value:y,onChange:e=>w(e.target.value),className:"p-inputtext-lg",style:{borderRadius:"6px",width:"100%"}}),(0,h.jsx)(n.e,{mode:"basic",auto:!1,customUpload:!0,chooseLabel:"Choose file",uploadHandler:e=>{var t;let{files:a}=e;j(a[0]),P((null===(t=a[0])||void 0===t?void 0:t.name)||"")},className:"p-button-primary",style:{width:"100%"}}),$&&(0,h.jsxs)("div",{style:{textAlign:"left",fontSize:"0.9rem",color:"#555"},children:[(0,h.jsx)("strong",{children:"Selected file:"})," ",$]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-3",children:[(0,h.jsx)(r.$,{label:"Upload",onClick:()=>{var e;g?(async e=>{let{files:t}=e;const a=t[0],s=new FormData;s.append("file",a),s.append("title",x),s.append("customName",y);try{var l;await m.A.post("".concat("https://atsbooks.onrender.com/","api/file"),s,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(C)}}),B(),f(!1),w(""),null===(l=z.current)||void 0===l||l.show({severity:"success",summary:"Uploaded",detail:"File uploaded successfuly",life:2e3})}catch(r){var o;console.error(r),null===(o=z.current)||void 0===o||o.show({severity:"error",summary:"Error",detail:"Upload failed",life:3e3})}})({files:[g]}):null===(e=z.current)||void 0===e||e.show({severity:"warn",summary:"Error",detail:"Press upload below",life:3e3})},className:"p-button-primary",style:{width:"40%"}}),(0,h.jsx)(r.$,{label:"Cancel",onClick:()=>{f(!1),j(null),P("")},className:"p-button-secondary",style:{width:"40%"}})]})]})}),(0,h.jsx)(c.y,{ref:z})]})}}}]);
//# sourceMappingURL=446.f6f7fcb4.chunk.js.map