"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[981],{8981:(e,a,t)=>{t.r(a),t.d(a,{default:()=>v});var s=t(5043),l=t(2018),i=t(65),n=t(9722),r=t(5797),o=t(8055),c=t(748),d=t(1045),m=t(3481),u=t(3003),p=t(3488),h=t(579);const g=e=>{const{createBook:a,visibleCreatBook:t,setVisibleCreatBook:i}=e,{token:g}=(0,u.d4)((e=>e.token)),[x,f]=(0,s.useState)(""),[y,j]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[k,N]=(0,s.useState)(!1),[w,S]=(0,s.useState)(!1),[A,C]=(0,s.useState)(null),[B,F]=(0,s.useState)(null),{gradeId:E}=(0,d.g)(),T=(0,p.z)().API_URL;(0,s.useEffect)((()=>{(async()=>{try{const e=await n.A.get("".concat(T,"api/grade"),{headers:{Authorization:"Bearer ".concat(g)}});if(204===e.status)v([]);else{const a=e.data.map((e=>({label:e.name,value:e.name,id:e._id})));if(v(a),E){const e=a.find((e=>e.id===E));e&&j([e.value])}}}catch(e){console.error("Error fetching grades:",e),v([])}})()}),[E]);return(0,h.jsx)(r.l,{visible:t,modal:!0,header:"Create Book",style:{width:"400px",borderRadius:"8px"},onHide:()=>i(!1),children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1rem"},children:[(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"name",className:"font-medium",children:"Name"}),(0,h.jsx)(o.S,{id:"name",className:"p-inputtext-sm ".concat(k?"p-invalid":""),type:"text",value:x,onChange:e=>f(e.target.value),placeholder:"Enter book name"}),k&&(0,h.jsx)("small",{className:"p-error",children:"This field is required."})]}),(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"grades",className:"font-medium",children:"Grades"}),(0,h.jsx)(c.K,{id:"grades",value:y,options:b,onChange:e=>j(e.value),optionLabel:"label",placeholder:"Select Grades",display:"chip",className:"p-multiselect-sm",virtualScrollerOptions:{itemSize:38}})]}),(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"image",className:"font-medium",children:"Upload Image"}),(0,h.jsx)(m.e,{name:"image",customUpload:!0,accept:"image/*",maxFileSize:5242880,uploadHandler:e=>{const a=e.files[0];a&&(C(a),F(URL.createObjectURL(a)))},chooseLabel:"Choose"}),B&&(0,h.jsx)("img",{src:B,alt:"Preview",style:{width:150,marginTop:10}})]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-2",children:[(0,h.jsx)(l.$,{label:"Create",onClick:()=>{a(x,y,A),C(null),F(null),f(null)},className:"p-button p-button-primary"}),(0,h.jsx)(l.$,{label:"Cancel",onClick:()=>{i(!1),C(null),F(null),f(null)},className:"p-button p-button-secondary"})]})]})})},x=e=>{const{updateBook:a,visible:t,book:i={},setVisible:d}=e,[u,g]=(0,s.useState)(null),[x,f]=(0,s.useState)(null!==i&&void 0!==i&&i.image?"".concat(i.image):""),[y,j]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),k=(0,s.useRef)(""),[N,w]=(0,s.useState)((null===i||void 0===i?void 0:i.name)||""),S=(0,p.z)().API_URL;(0,s.useEffect)((()=>{(async()=>{try{const e=await n.A.get("".concat(S,"api/grade"));if(204===e.status)j([]);else{const a=e.data.map((e=>({label:e.name,value:e.name})));j(a)}}catch(e){console.error("Error fetching grades:",e),j([])}})()}),[]),(0,s.useEffect)((()=>{if(null!==i&&void 0!==i&&i.grades&&i.grades.length>0){const e=i.grades.map((e=>e.name));v(e)}}),[i,y]),(0,s.useEffect)((()=>{null!==i&&void 0!==i&&i.image&&f("".concat(i.image))}),[i.image]);return(0,h.jsx)(r.l,{visible:t,modal:!0,header:"Update Book",style:{width:"400px",borderRadius:"8px"},onHide:()=>{g(null),f(i.image),d(!1)},children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1rem"},children:[(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"name",className:"font-medium",children:"Name"}),(0,h.jsx)(o.S,{id:"name",placeholder:"Enter book name",className:"p-inputtext-sm",onChange:e=>{w(e.target.value)},defaultValue:(null===i||void 0===i?void 0:i.name)||""})]}),(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"grades",className:"font-medium",children:"Grades"}),(0,h.jsx)(c.K,{id:"grades",value:b,options:y,onChange:e=>v(e.value),optionLabel:"label",placeholder:"Select Grades",display:"chip",className:"w-full md:w-20rem custom-multiselect"})]}),(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"image",className:"font-medium",children:"Upload New Image"}),(0,h.jsx)(m.e,{name:"image",customUpload:!0,accept:"image/*",maxFileSize:5242880,uploadHandler:e=>{const a=e.target.files[0];a&&(g(a),f(URL.createObjectURL(a)))}}),x&&(0,h.jsx)("img",{src:x,alt:"Preview",style:{width:150,marginTop:10}})]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-2",children:[(0,h.jsx)(l.$,{label:"Update",onClick:()=>{w(k.current.value||i.name);const e=u||i.image;a(N,b,e,i),d(!1)},className:"p-button p-button-primary"}),(0,h.jsx)(l.$,{label:"Cancel",onClick:()=>{g(null),f(i.image||""),d(!1)},className:"p-button p-button-secondary"})]})]})})};t(9906);var f=t(3740),y=t(828),j=t(970),b=t(2866);function v(){const[e,a]=(0,s.useState)([]),[t,r]=(0,s.useState)("grid"),[o,c]=(0,s.useState)({}),[m,v]=(0,s.useState)(!1),[k,N]=(0,s.useState)(""),[w,S]=(0,s.useState)(!1),[A,C]=(0,s.useState)(!1),{gradeId:B}=(0,d.g)(),{token:F}=(0,u.d4)((e=>e.token)),{user:E}=(0,u.d4)((e=>e.token)),[T,R]=(0,s.useState)(!1),U=(0,d.Zp)(),L=(0,s.useRef)(null),z=(0,p.z)().API_URL,G=(0,s.useRef)(null),I=(0,s.useRef)(null),[P,_]=(0,s.useState)(!1);(0,s.useEffect)((()=>{(async()=>{_(!0);try{B?(await $(B),await O(B)):(await H(),N(""))}finally{_(!1)}})()}),[B,m]);const $=async e=>{try{const a=await n.A.get("".concat(z,"api/grade/").concat(e));200===a.status&&N(a.data.name)}catch(a){console.error("Error fetching grade name:",a),N("")}},H=async()=>{try{const e=await n.A.get("".concat(z,"api/book"));200===e.status&&a(e.data)}catch(e){console.error(e)}},O=async e=>{try{const t=await n.A.get("".concat(z,"api/book/grade/").concat(e));200===t.status&&a(t.data),204===t.status&&G.current&&(G.current.clear(),G.current.show([{sticky:!0,severity:"warn",detail:"There are no books yet to this grade.",closable:!1}]))}catch(t){console.error("error: ",t),G.current&&(G.current.clear(),G.current.show([{sticky:!0,severity:"error",detail:"there was a problem, try again later.",closable:!1}]))}},V=e=>(0,h.jsx)("div",{className:"col-12 sm:col-6 lg:col-4 xl:col-3 p-2",children:(0,h.jsxs)("div",{className:"p-4 border-1 surface-border surface-card border-round",onClick:()=>(e=>{F?"Take It Easy"==e.name||"Go Ahead"==e.name||"Go Ahead Boys"==e.name?I.current.show({severity:"error",detail:"This book is not in use any more.",life:3e3}):U("/titles/".concat(e._id)):I.current.show({severity:"error",detail:"You must log-in to view the book files.",life:3e3})})(e),style:{cursor:"pointer",height:"640px"},children:[(0,h.jsxs)("div",{style:{position:"relative",width:"100%",height:"550px"},className:"flex flex-column align-items-center gap-3 py-5",children:[(0,h.jsx)("img",{className:"object-cover w-full h-full",src:e.image,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",minHeight:"100px",filter:"Take It Easy"===e.name||"Go Ahead"==e.name||"Go Ahead Boys"==e.name?"grayscale(100%) brightness(1)":"none",opacity:"Take It Easy"===e.name||"Go Ahead"==e.name||"Go Ahead Boys"==e.name?.6:1,borderRadius:"8px"}}),(0,h.jsx)("div",{className:"text-2xl font-bold",children:e.name}),e.grades&&e.grades.length>0&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("strong",{children:"Suitable for:"}),(0,h.jsx)("ul",{className:"m-0 pl-3 list-disc text-xs",children:e.grades.map(((e,a)=>(0,h.jsx)("li",{children:e.name},a)))})]})]}),(0,h.jsx)("div",{style:{marginTop:"auto",paddingBottom:"0px",paddingTop:"0px",marginBottom:"0px"},className:"card flex flex-wrap gap-2 justify-content-center",children:"Admin"===(null===E||void 0===E?void 0:E.roles)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.$,{icon:"pi pi-pencil",onClick:a=>{a.stopPropagation(),C(!0),c(e)},tooltip:"Edit"}),(0,h.jsx)(l.$,{icon:"pi pi-trash",onClick:a=>{a.stopPropagation(),(0,j.P)({target:a.currentTarget,message:"Are you sure you want to delete this book and all the files in it?",icon:"pi pi-exclamation-triangle",defaultFocus:"accept",accept:()=>{a.stopPropagation(),(async e=>{R(!0);try{await n.A.delete("".concat(z,"api/book/").concat(e),{headers:{Authorization:"Bearer ".concat(F)}}),v(!m)}catch(a){console.error("Error deleting book:",a)}finally{R(!1)}})(e._id),C(!1)},reject:()=>{a.stopPropagation(),C(!1)}})},tooltip:"Delete"})]})})]})},e._id);return(0,h.jsx)("div",{children:P?(0,h.jsx)("div",{className:"flex justify-content-center align-items-center",style:{height:"80vh"},children:(0,h.jsxs)("div",{className:"flex justify-center items-center gap-3 text-xl mt-6",children:[(0,h.jsx)("div",{className:"custom-spinner"}),(0,h.jsx)("span",{children:"Loading, please wait..."})]})}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(y.y,{ref:I}),(0,h.jsx)(b.B,{ref:G}),(0,h.jsx)(y.y,{ref:L}),(0,h.jsx)(j.r,{}),T&&(0,h.jsxs)("div",{style:{margin:"20px"},children:[(0,h.jsx)(f.p,{style:{width:"30px",height:"30px"},strokeWidth:"5"}),(0,h.jsx)("p",{children:"Wait just a moment please..."})]}),(0,h.jsx)("div",{children:k&&(0,h.jsx)("h1",{className:"grade-header",children:k})}),"Admin"===(null===E||void 0===E?void 0:E.roles)&&(0,h.jsx)(l.$,{icon:"pi pi-plus",rounded:!0,"aria-label":"Filter",onClick:()=>S(!0),className:"add-button"}),(0,h.jsx)(g,{createBook:async(e,a,t)=>{R(!0),t||I.current.show({severity:"warn",detail:"You must press uploal to confirm the image",life:3e3});const s=new FormData;s.append("name",e),s.append("grades",JSON.stringify(a)),s.append("image",t);try{const e=await n.A.post("".concat(z,"api/book"),s,{headers:{Authorization:"Bearer ".concat(F),"Content-Type":"multipart/form-data"}});200!==e.status&&201!==e.status||(S(!1),B?O(B):H())}catch(l){S(!1),400===l.status&&(console.error("Error creating book:",l),I.current.show({severity:"error",detail:"Error creating book",life:3e3})),402===l.status&&I.current.show({severity:"error",detail:"This book name already exists",life:3e3})}finally{R(!1)}},setVisibleCreatBook:S,visibleCreatBook:w}),(0,h.jsx)("div",{className:"card",children:(0,h.jsx)(i.U$,{value:Array.isArray(e)?e:[],listTemplate:(e,a)=>(0,h.jsx)("div",{className:"grid grid-nogutter",children:e.map(((e,a)=>(e=>{if(e)return V(e)})(e)))}),layout:t})}),o?(0,h.jsx)(x,{updateBook:async(e,a,t,s)=>{R(!0);const l=new FormData;l.append("_id",s._id),l.append("name",e||s.name),l.append("grades",JSON.stringify(a)),(t instanceof File||t instanceof Blob)&&l.append("image",t);try{200===(await n.A.put("".concat(z,"api/book"),l,{headers:{Authorization:"Bearer ".concat(F),"Content-Type":"multipart/form-data"}})).status&&v(!m)}catch(i){console.error(i)}finally{R(!1)}},setVisible:C,visible:A,book:o}):(0,h.jsx)(h.Fragment,{})]})})}},9906:()=>{}}]);
//# sourceMappingURL=981.1ca564de.chunk.js.map