"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[981],{8981:(e,a,t)=>{t.r(a),t.d(a,{default:()=>b});var s=t(9379),l=t(5043),o=t(2018),n=t(65),r=t(9722),i=t(5797),c=t(8055),d=t(748),m=t(4315),u=t(7780),p=t(3003),h=t(579);const g=e=>{const{createBook:a,visibleCreatBook:t,setVisibleCreatBook:s}=e,{token:n}=(0,p.d4)((e=>e.token)),[g,x]=(0,l.useState)(""),[f,b]=(0,l.useState)([]),[j,v]=(0,l.useState)([]),[k,y]=(0,l.useState)(!1),[N,S]=(0,l.useState)(!1),[C,w]=(0,l.useState)(null),[A,B]=(0,l.useState)(null),{gradeId:F}=(0,m.g)();(0,l.useEffect)((()=>{(async()=>{try{const e=await r.A.get("".concat("https://atsbooks.onrender.com/","api/grade"),{headers:{Authorization:"Bearer ".concat(n)}});if(204===e.status)v([]);else{const a=e.data.map((e=>({label:e.name,value:e.name,id:e._id})));if(v(a),F){const e=a.find((e=>e.id===F));e&&b([e.value])}}}catch(e){console.error("Error fetching grades:",e),v([])}})()}),[F]);return(0,h.jsx)(i.l,{visible:t,modal:!0,header:"Create Book",style:{width:"400px",borderRadius:"8px"},onHide:()=>s(!1),children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1rem"},children:[(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"name",className:"font-medium",children:"Name"}),(0,h.jsx)(c.S,{id:"name",className:"p-inputtext-sm ".concat(k?"p-invalid":""),type:"text",value:g,onChange:e=>x(e.target.value),placeholder:"Enter book name"}),k&&(0,h.jsx)("small",{className:"p-error",children:"This field is required."})]}),(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"grades",className:"font-medium",children:"Grades"}),(0,h.jsx)(d.K,{id:"grades",value:f,options:j,onChange:e=>b(e.value),optionLabel:"label",placeholder:"Select Grades",display:"chip",className:"p-multiselect-sm",virtualScrollerOptions:{itemSize:38}})]}),(0,h.jsxs)("div",{className:"inline-flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"image",className:"font-medium",children:"Upload Image"}),(0,h.jsx)(u.e,{name:"image",customUpload:!0,accept:"image/*",maxFileSize:5242880,uploadHandler:e=>{const a=e.files[0];a&&(w(a),B(URL.createObjectURL(a)))},emptyTemplate:(0,h.jsx)("p",{children:"Drag an image file or click to select."}),chooseLabel:"Choose",uploadLabel:"Confirm",cancelLabel:"Cancel"}),A&&(0,h.jsx)("img",{src:A,alt:"Preview",style:{width:150,marginTop:10}})]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-2",children:[(0,h.jsx)(o.$,{label:"Create",onClick:()=>{a(g,f,C),s(!1),w(null),B(null),x(null)},className:"p-button p-button-primary"}),(0,h.jsx)(o.$,{label:"Cancel",onClick:()=>{s(!1),w(null),B(null),x(null)},className:"p-button p-button-secondary"})]})]})})},x=e=>{const{updateBook:a,visible:t,book:s={},setVisible:n}=e,[m,p]=(0,l.useState)(null),[g,x]=(0,l.useState)(null!==s&&void 0!==s&&s.image?"".concat("https://atsbooks.onrender.com/").concat(s.image):""),[f,b]=(0,l.useState)([]),[j,v]=(0,l.useState)([]),k=(0,l.useRef)(""),[y,N]=(0,l.useState)((null===s||void 0===s?void 0:s.name)||"");(0,l.useEffect)((()=>{(async()=>{try{const e=await r.A.get("".concat("https://atsbooks.onrender.com/","api/grade"));if(204===e.status)b([]);else{const a=e.data.map((e=>({label:e.name,value:e.name})));b(a)}}catch(e){console.error("Error fetching grades:",e),b([])}})()}),[]),(0,l.useEffect)((()=>{if(null!==s&&void 0!==s&&s.grades&&s.grades.length>0){const e=s.grades.map((e=>e.name));v(e)}}),[s,f]),(0,l.useEffect)((()=>{null!==s&&void 0!==s&&s.image&&x("".concat("https://atsbooks.onrender.com/").concat(s.image))}),[s.image]);return(0,h.jsx)(i.l,{visible:t,modal:!0,header:"Update Book",style:{width:"400px",borderRadius:"8px"},onHide:()=>{p(null),x(s.image||""),n(!1)},children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1rem"},children:[(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"name",className:"font-medium",children:"Name"}),(0,h.jsx)(c.S,{id:"name",placeholder:"Enter book name",className:"p-inputtext-sm",onChange:e=>{N(e.target.value)},defaultValue:(null===s||void 0===s?void 0:s.name)||""})]}),(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"grades",className:"font-medium",children:"Grades"}),(0,h.jsx)(d.K,{id:"grades",value:j,options:f,onChange:e=>v(e.value),optionLabel:"label",placeholder:"Select Grades",display:"chip",className:"w-full md:w-20rem custom-multiselect"})]}),(0,h.jsxs)("div",{className:"flex flex-column gap-2",children:[(0,h.jsx)("label",{htmlFor:"image",className:"font-medium",children:"Upload New Image"}),(0,h.jsx)(u.e,{name:"image",customUpload:!0,accept:"image/*",maxFileSize:5242880,uploadHandler:e=>{const a=e.files[0];a&&(p(a),x(URL.createObjectURL(a)))},emptyTemplate:(0,h.jsx)("p",{children:"Drag an image file or click to select."})}),g&&(0,h.jsx)("img",{src:g,alt:"Preview",style:{width:150,marginTop:10}})]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-2",children:[(0,h.jsx)(o.$,{label:"Update",onClick:()=>{N(k.current.value||s.name);const e=m||s.image;a(y,j,e,s),n(!1)},className:"p-button p-button-primary"}),(0,h.jsx)(o.$,{label:"Cancel",onClick:()=>{p(null),x(s.image||""),n(!1)},className:"p-button p-button-secondary"})]})]})})};t(9906);var f=t(3740);function b(){const[e,a]=(0,l.useState)([]),[t,i]=(0,l.useState)("grid"),[c,d]=(0,l.useState)({}),[u,b]=(0,l.useState)(!1),[j,v]=(0,l.useState)(""),[k,y]=(0,l.useState)(!1),[N,S]=(0,l.useState)(!1),{gradeId:C}=(0,m.g)(),{token:w}=(0,p.d4)((e=>e.token)),{user:A}=(0,p.d4)((e=>e.token)),B=(0,m.Zp)();(0,l.useEffect)((()=>{C?(F(C),U(C)):(E(),v(""))}),[C,u]);const F=async e=>{try{const a=await r.A.get("".concat("https://atsbooks.onrender.com/","api/grade/").concat(e));200===a.status&&v(a.data.name)}catch(a){console.error("Error fetching grade name:",a),v("")}},E=async()=>{try{const e=await r.A.get("".concat("https://atsbooks.onrender.com/","api/book"));200===e.status&&a(e.data)}catch(e){console.error(e)}},U=async e=>{try{const t=await r.A.get("".concat("https://atsbooks.onrender.com/","api/book/grade/").concat(e));200===t.status&&a(t.data)}catch(t){400===t.status&&alert("there are no book for this grade")}},[L,T]=(0,l.useState)(!1),$=e=>(0,h.jsx)("div",{className:"col-12 sm:col-6 lg:col-12 xl:col-4 p-2",children:(0,h.jsxs)("div",{className:"p-4 border-1 surface-border surface-card border-round",onClick:()=>{return a=e._id,void(w?B("/titles/".concat(a)):alert("You are not allowed to view the book files."));var a},style:{cursor:"pointer"},children:[(0,h.jsxs)("div",{className:"flex flex-column align-items-center gap-3 py-5",children:[(0,h.jsx)("img",{className:"object-cover w-full h-full",src:"".concat("https://atsbooks.onrender.com/").concat(e.image),alt:e.name,style:{objectFit:"cover",width:"80%",height:"80%"}}),(0,h.jsx)("div",{className:"text-2xl font-bold",children:e.name}),e.grades&&e.grades.length>0&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("strong",{children:"Suitable for:"}),(0,h.jsx)("ul",{className:"m-0 pl-3 list-disc text-xs",children:e.grades.map(((e,a)=>(0,h.jsx)("li",{children:e.name},a)))})]})]}),(0,h.jsx)("div",{className:"card flex flex-wrap gap-2 justify-content-center",children:"Admin"===(null===A||void 0===A?void 0:A.roles)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(o.$,{icon:"pi pi-pencil",onClick:a=>{a.stopPropagation(),S(!0),d(e)},tooltip:"Edit"}),(0,h.jsx)(o.$,{icon:"pi pi-trash",onClick:a=>{a.stopPropagation(),(async e=>{T(!0);try{await r.A.delete("".concat("https://atsbooks.onrender.com/","api/book/").concat(e),{headers:{Authorization:"Bearer ".concat(w)}}),b(!u)}catch(a){console.error("Error deleting book:",a)}finally{T(!1)}})(e._id)},tooltip:"Delete"})]})})]})},e._id);return(0,h.jsxs)("div",{children:[L&&(0,h.jsxs)("div",{style:{margin:"20px"},children:[(0,h.jsx)(f.p,{style:{width:"30px",height:"30px"},strokeWidth:"5"}),(0,h.jsx)("p",{children:"Wait just a moment please..."})]}),(0,h.jsx)("div",{children:j&&(0,h.jsx)("h1",{className:"grade-header",children:j})}),"Admin"===(null===A||void 0===A?void 0:A.roles)&&(0,h.jsx)(o.$,{icon:"pi pi-plus",rounded:!0,"aria-label":"Filter",onClick:()=>y(!0),className:"add-button"}),(0,h.jsx)(g,{createBook:async(e,a,t)=>{T(!0),t||alert("confirm the image");const s=new FormData;s.append("name",e),s.append("grades",JSON.stringify(a)),s.append("image",t);try{const e=await r.A.post("".concat("https://atsbooks.onrender.com/","api/book"),s,{headers:{Authorization:"Bearer ".concat(w),"Content-Type":"multipart/form-data"}});200!==e.status&&201!==e.status||(C?U(C):E())}catch(l){alert(l.res.data.mes),400===l.status&&console.error("Error creating book:",l),402===l.status&&alert("this book name alrady exits")}finally{T(!1)}},setVisibleCreatBook:y,visibleCreatBook:k}),(0,h.jsx)("div",{className:"card",children:(0,h.jsx)(n.U$,{value:Array.isArray(e)?e:[],listTemplate:(e,a)=>(0,h.jsx)("div",{className:"grid grid-nogutter",children:e.map(((e,a)=>(e=>{if(e)return $(e)})(e)))}),layout:t})}),c?(0,h.jsx)(x,{updateBook:async(e,a,t,l)=>{T(!0);const o=(0,s.A)((0,s.A)({},l),{},{name:e||l.name,grades:a,image:t||l.image});try{200===(await r.A.put("".concat("https://atsbooks.onrender.com/","api/book"),o,{headers:{Authorization:"Bearer ".concat(w),"Content-Type":"multipart/form-data"}})).status&&b(!u)}catch(n){console.error(n)}finally{T(!1)}},setVisible:S,visible:N,book:c}):(0,h.jsx)(h.Fragment,{})]})}},9906:()=>{}}]);
//# sourceMappingURL=981.a9a16245.chunk.js.map