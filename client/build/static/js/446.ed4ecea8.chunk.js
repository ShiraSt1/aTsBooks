"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[446],{446:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var l=a(9379),s=a(5043),o=a(8072),i=a(2018),r=a(5797),n=a(7780),c=a(828),d=a(8055),u=a(9722),m=a(4315),p=a(3003),h=a(579);const f=()=>{const[e,t]=(0,s.useState)([]),[a,f]=(0,s.useState)(!1),[x,v]=(0,s.useState)(null),[y,w]=(0,s.useState)(""),[g,j]=(0,s.useState)(null),[b,N]=(0,s.useState)({}),[k,A]=(0,s.useState)(null),{token:C}=(0,p.d4)((e=>e.token)),{user:S}=(0,p.d4)((e=>e.token)),z=(0,s.useRef)(null),{bookId:_}=(0,m.g)(),E=(0,m.Zp)();(0,s.useEffect)((()=>{(async()=>{try{const e=await u.A.get("".concat("http://localhost:3001/","api/book/").concat(_),{headers:{Authorization:"Bearer ".concat(C)}});A(e.data)}catch(e){400===e.status&&(null===z||void 0===z||z.current.show({severity:"error",summary:"Error",detail:"No book found",life:3e3})),console.error("error loading book:",e)}})(),B()}),[]);const B=async()=>{try{const e=(await u.A.get("".concat("http://localhost:3001/","api/title/getTitlesByBook/").concat(_),{headers:{Authorization:"Bearer ".concat(C)}})).data,a={};for(const t of e){const e=await u.A.get("".concat("http://localhost:3001/","api/file/title/").concat(t._id),{headers:{Authorization:"Bearer ".concat(C)}});a[t._id]=e.data}N(a);const l=e.map((e=>({label:(0,h.jsxs)("div",{className:"flex justify-between align-items-center w-full",children:[(0,h.jsx)("span",{children:e.name}),"Admin"===(null===S||void 0===S?void 0:S.roles)&&(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(i.$,{icon:"pi pi-plus",rounded:!0,text:!0,size:"small",onClick:t=>{t.stopPropagation(),v(e._id),f(!0)}})})]}),items:(a[e._id]||[]).map((t=>({label:(0,h.jsxs)("div",{className:"flex justify-between align-items-center w-full gap-2",children:[(0,h.jsx)("span",{style:{maxWidth:"30%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t.name,children:t.name}),(0,h.jsxs)("span",{className:"flex gap-2",children:[(0,h.jsx)(i.$,{icon:"pi pi-eye",rounded:!0,text:!0,size:"small",onClick:e=>{e.stopPropagation(),E("/fileview/".concat(t._id))}}),(0,h.jsx)(i.$,{icon:"pi pi-download",rounded:!0,text:!0,size:"small",onClick:e=>{e.stopPropagation(),window.open("".concat("http://localhost:3001/","api/file/download/").concat(t._id,"?name=").concat(t.customName||t.name),"_blank")}}),"Admin"===(null===S||void 0===S?void 0:S.roles)&&(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(i.$,{icon:"pi pi-trash",rounded:!0,text:!0,size:"small",severity:"danger",onClick:a=>{a.stopPropagation(),F(t._id,e._id)}})})]})]})})))})));t(l)}catch(a){var e;console.error(a),null===(e=z.current)||void 0===e||e.show({severity:"error",summary:"Error",detail:"Error loading",life:3e3})}},F=async(e,t)=>{try{var a;await u.A.delete("".concat("http://localhost:3001/","api/file/").concat(e),{headers:{Authorization:"Bearer ".concat(C)}}),N((a=>(0,l.A)((0,l.A)({},a),{},{[t]:a[t].filter((t=>t._id!==e))}))),B(),null===(a=z.current)||void 0===a||a.show({severity:"success",summary:"Deleted",detail:"File deleted successfuly",life:2e3})}catch(o){var s;console.error(o),null===(s=z.current)||void 0===s||s.show({severity:"error",summary:"Error",detail:"Error deleting",life:3e3})}},[$,P]=(0,s.useState)("");return(0,h.jsxs)("div",{className:"p-4",children:[k&&(0,h.jsx)("h2",{className:"text-center mb-4",children:k.name}),(0,h.jsxs)("div",{className:"flex flex-column md:flex-row gap-4",children:[(null===k||void 0===k?void 0:k.image)&&(0,h.jsx)("div",{className:"flex justify-content-center md:w-4",children:(0,h.jsx)("img",{src:"".concat("http://localhost:3001/").concat(k.image),alt:"Book",className:"border-round shadow-2",style:{maxWidth:"100%",maxHeight:"500px",objectFit:"contain"}})}),(0,h.jsx)("div",{className:"flex-grow-1",children:(0,h.jsx)(o.G,{model:e,className:"w-full md:w-30rem"})})]}),(0,h.jsx)(r.l,{header:"Upload new file",visible:a,onHide:()=>{f(!1),j(null),P("")},style:{width:"30rem",borderRadius:"8px",textAlign:"center"},className:"custom-upload-dialog",children:(0,h.jsxs)("div",{className:"flex flex-column gap-4",style:{padding:"1.5rem"},children:[(0,h.jsx)("label",{htmlFor:"fileName",className:"font-medium",style:{textAlign:"left"},children:"File name"}),(0,h.jsx)(d.S,{id:"fileName",placeholder:"Enter file name",value:y,onChange:e=>w(e.target.value),className:"p-inputtext-lg",style:{borderRadius:"6px",width:"100%"}}),(0,h.jsx)(n.e,{mode:"basic",auto:!1,customUpload:!0,chooseLabel:"Choose file",uploadHandler:e=>{var t;let{files:a}=e;j(a[0]),P((null===(t=a[0])||void 0===t?void 0:t.name)||"")},className:"p-button-primary",style:{width:"100%"}}),$&&(0,h.jsxs)("div",{style:{textAlign:"left",fontSize:"0.9rem",color:"#555"},children:[(0,h.jsx)("strong",{children:"Selected file:"})," ",$]}),(0,h.jsxs)("div",{className:"flex justify-content-center gap-3",children:[(0,h.jsx)(i.$,{label:"Upload",onClick:()=>{var e;g?(async e=>{let{files:t}=e;const a=t[0],l=new FormData;l.append("file",a),l.append("title",x),l.append("customName",y);try{var s;await u.A.post("".concat("http://localhost:3001/","api/file"),l,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(C)}}),B(),f(!1),w(""),null===(s=z.current)||void 0===s||s.show({severity:"success",summary:"Uploaded",detail:"File uploaded successfuly",life:2e3})}catch(i){var o;console.error(i),null===(o=z.current)||void 0===o||o.show({severity:"error",summary:"Error",detail:"Upload failed",life:3e3})}})({files:[g]}):null===(e=z.current)||void 0===e||e.show({severity:"warn",summary:"Error",detail:"Press upload below",life:3e3})},className:"p-button-primary",style:{width:"40%"}}),(0,h.jsx)(i.$,{label:"Cancel",onClick:()=>{f(!1),j(null),P("")},className:"p-button-secondary",style:{width:"40%"}})]})]})}),(0,h.jsx)(c.y,{ref:z})]})}}}]);
//# sourceMappingURL=446.ed4ecea8.chunk.js.map